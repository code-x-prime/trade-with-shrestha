generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                      String                   @id @default(cuid())
  email                   String                   @unique
  name                    String?
  password                String?
  avatar                  String?
  phone                   String?
  authProvider            AuthProvider             @default(EMAIL)
  googleId                String?                  @unique
  role                    UserRole                 @default(STUDENT)
  isVerified              Boolean                  @default(false)
  isActive                Boolean                  @default(true)
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  lastLoginAt             DateTime?
  otps                    OTP[]
  sessions                Session[]
  orders                  Order[]
  reviews                 Review[]
  webinarOrders           WebinarOrderItem[]
  guidanceOrders          GuidanceOrder[]
  courseEnrollments       CourseEnrollment[]
  courseOrders            CourseOrder[]
  courseReviews           CourseReview[]
  certificates            Certificate[]
  courseCompletions       CourseCompletion[]
  webinarCompletions      WebinarCompletion[]
  cartItems               CartItem[]
  offlineBatchEnrollments OfflineBatchEnrollment[]
  offlineBatchOrders      OfflineBatchOrder[]
  bundleEnrollments       BundleEnrollment[]
  bundleOrders            BundleOrder[]
  jobs                    Job[]
  jobApplications         JobApplication[]

  @@index([email])
  @@index([googleId])
}

model OTP {
  id        String   @id @default(cuid())
  userId    String
  code      String
  purpose   String
  expiresAt DateTime
  isUsed    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([code])
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
}

enum AuthProvider {
  EMAIL
  GOOGLE
}

enum UserRole {
  STUDENT
  ADMIN
}

enum BatchType {
  ONLINE
  OFFLINE
}

enum ValidityType {
  LIFETIME
  SIX_MONTHS
  ONE_YEAR
}

enum OrderStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

model Ebook {
  id               String      @id @default(cuid())
  title            String
  slug             String      @unique
  shortDescription String?     @db.Text
  description      String      @db.Text
  price            Float       @default(0)
  salePrice        Float?
  isFree           Boolean     @default(false)
  image1           String?
  image2           String?
  image3           String?
  pdfFile          String? // PDF file path in R2
  pages            Int         @default(0)
  curriculum       String[] // Array of curriculum points
  categories       String[] // Array of categories: FEATURED, BESTSELLER, NEW, TRENDING, POPULAR
  isPublished      Boolean     @default(false)
  purchaseCount    Int         @default(0)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  orders           OrderItem[]
  reviews          Review[]

  @@index([isPublished])
  @@index([isFree])
  @@index([slug])
}

model Order {
  id                 String              @id @default(cuid())
  userId             String
  orderNumber        String              @unique
  orderType          String              @default("EBOOK") // EBOOK, SUBSCRIPTION, WEBINAR, GUIDANCE, COURSE, OFFLINE_BATCH, or BUNDLE
  totalAmount        Float
  discountAmount     Float               @default(0)
  finalAmount        Float
  status             OrderStatus         @default(PENDING)
  paymentStatus      PaymentStatus       @default(PENDING)
  razorpayOrderId    String?
  razorpayPaymentId  String?
  razorpaySignature  String?
  couponCode         String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  items              OrderItem[]
  courseOrders       CourseOrder[]
  offlineBatchOrders OfflineBatchOrder[]
  bundleOrders       BundleOrder[]

  @@index([userId])
  @@index([orderNumber])
  @@index([status])
  @@index([orderType])
}

model OrderItem {
  id        String   @id @default(cuid())
  orderId   String
  ebookId   String
  price     Float
  salePrice Float?
  isFree    Boolean  @default(false)
  createdAt DateTime @default(now())
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  ebook     Ebook    @relation(fields: [ebookId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([ebookId])
}

model Review {
  id        String   @id @default(cuid())
  userId    String
  ebookId   String
  rating    Int // 1-5
  comment   String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  ebook     Ebook    @relation(fields: [ebookId], references: [id], onDelete: Cascade)

  @@unique([userId, ebookId]) // One review per user per ebook
  @@index([ebookId])
  @@index([userId])
}

model Coupon {
  id                String   @id @default(cuid())
  code              String   @unique
  discountType      String // PERCENTAGE or FIXED
  discountValue     Float
  minAmount         Float?
  maxDiscount       Float?
  validFrom         DateTime
  validUntil        DateTime
  usageLimit        Int?
  usedCount         Int      @default(0)
  isActive          Boolean  @default(true)
  applicableTo      String   @default("ALL") // ALL, EBOOK, SUBSCRIPTION, WEBINAR, GUIDANCE, COURSE, OFFLINE_BATCH, BUNDLE
  targetUserType    String   @default("ALL") // ALL, NEW_USER, SPECIFIC_USER
  targetUserId      String? // If targetUserType is SPECIFIC_USER
  targetContentType String? // Specific content type for popup display
  imageUrl          String? // Image for popup (from MediaPicker)
  videoUrl          String? // Video for popup
  readyToShow       Boolean  @default(false) // Whether to show in popup
  title             String? // Title for popup
  description       String?  @db.Text // Description for popup
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([code])
  @@index([isActive])
  @@index([readyToShow])
  @@index([targetUserType])
}

model Webinar {
  id String @id @default(cuid())

  // ===============================
  // BASIC INFO
  // ===============================
  title       String
  slug        String   @unique
  type        LiveType
  description String   @db.Text
  image       String? // Thumbnail (Cloudflare R2)

  // ===============================
  // LIVE SESSION (GOOGLE MEET)
  // ===============================
  googleMeetLink String? // üîê only for enrolled users
  startDate      DateTime // Webinar date and time
  startTime      String // HH:mm (extracted from startDate for compatibility)
  endTime        String? // Calculated from startDate + duration
  duration       Int? // Duration in minutes (e.g., 45, 75)

  // ===============================
  // INSTRUCTOR INFO
  // ===============================
  instructorName            String
  instructorDescription     String? @db.Text
  instructorImage           String?
  instructorYearsExperience Int?

  // ===============================
  // PRICING
  // ===============================
  price     Float   @default(0)
  salePrice Float?
  isFree    Boolean @default(false)

  // ===============================
  // SEAT MANAGEMENT
  // ===============================
  seatType SeatType @default(UNLIMITED)
  maxSeats Int?

  // ===============================
  // COURSE META
  // ===============================
  numberOfSessions Int?
  language         String?
  accessDuration   AccessDuration?
  liveDoubtSolving Boolean         @default(false)

  // ===============================
  // RECORDING ACCESS (NO URL)
  // ===============================
  accessToRecordings       Boolean @default(false)
  recordingsAccessDuration String?

  // ===============================
  // MARKETING CONTENT
  // ===============================
  thumbnailVideoUrl String?
  whatYouWillLearn  Json    @default("[]")
  faqs              Json    @default("[]")

  // ===============================
  // STATUS
  // ===============================
  isPublished Boolean @default(false)

  // ===============================
  // RELATIONS
  // ===============================
  orders      WebinarOrderItem[]
  completions WebinarCompletion[]

  // ===============================
  // TIMESTAMPS
  // ===============================
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isPublished, isFree])
}

enum LiveType {
  LIVE
  WORKSHOP
  MASTERCLASS
}

enum SeatType {
  UNLIMITED
  LIMITED
}

enum AccessDuration {
  SIX_MONTHS
  ONE_YEAR
  LIFETIME
}

model WebinarOrderItem {
  id String @id @default(cuid())

  webinarId String
  userId    String

  amountPaid  Float
  paymentId   String?
  paymentMode String? // RAZORPAY | CASHFREE | FREE

  webinar Webinar @relation(fields: [webinarId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([webinarId, userId])
  @@index([webinarId])
  @@index([userId])
}

enum GuidanceStatus {
  ACTIVE
  INACTIVE
}

enum SlotStatus {
  AVAILABLE
  BOOKED
  CLOSED
}

model Guidance {
  id          String @id @default(cuid())
  title       String // 1:1 Guidance
  slug        String @unique
  description String @db.Text

  expertName  String
  expertBio   String? @db.Text
  expertImage String? // R2 image
  expertise   Json    @default("[]") // Options Trading, etc
  language    String?

  price           Float // INR only (NOT FREE)
  durationMinutes Int // 30 / 60 / 90

  googleMeetLink String // Admin provided

  status GuidanceStatus @default(ACTIVE)

  slots  GuidanceSlot[]
  orders GuidanceOrder[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([status])
}

model GuidanceSlot {
  id         String   @id @default(cuid())
  guidanceId String
  date       DateTime // YYYY-MM-DD
  startTime  String // HH:mm
  endTime    String // HH:mm

  status SlotStatus @default(AVAILABLE)

  guidance Guidance       @relation(fields: [guidanceId], references: [id], onDelete: Cascade)
  order    GuidanceOrder?

  @@unique([guidanceId, date, startTime])
  @@index([guidanceId])
  @@index([status])
}

model GuidanceOrder {
  id         String @id @default(cuid())
  guidanceId String
  slotId     String @unique
  userId     String

  amountPaid    Float
  paymentId     String?
  paymentStatus String // CREATED | PAID | FAILED
  paymentMode   String? // RAZORPAY

  guidance Guidance     @relation(fields: [guidanceId], references: [id], onDelete: Cascade)
  slot     GuidanceSlot @relation(fields: [slotId], references: [id], onDelete: Cascade)
  user     User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([guidanceId])
  @@index([slotId])
  @@index([userId])
}

// =====================================
// ONLINE COURSE SYSTEM
// =====================================

enum CourseLanguage {
  HINDI
  ENGLISH
  MIXED
}

enum CourseDeliveryMode {
  ONLINE // Live/online classes ‚Äì curriculum as text, book demo
  SELF_PACED // Self-paced ‚Äì video + lecture names, purchase
  BOTH // Both options ‚Äì show book demo + self-paced purchase, curriculum text + lecture list
}

model CourseCategory {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  isDefault Boolean  @default(false)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  courses CourseCategoryRelation[]

  @@index([slug])
  @@index([isActive])
}

model CourseCategoryRelation {
  id         String @id @default(cuid())
  courseId   String
  categoryId String

  course   Course         @relation(fields: [courseId], references: [id], onDelete: Cascade)
  category CourseCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([courseId, categoryId])
  @@index([courseId])
  @@index([categoryId])
}

model Course {
  id             String             @id @default(cuid())
  title          String
  slug           String             @unique
  description    String             @db.Text
  coverImage     String? // R2 URL
  language       CourseLanguage     @default(ENGLISH)
  price          Float              @default(0)
  salePrice      Float?
  isFree         Boolean            @default(false)
  isPublished    Boolean            @default(false)
  badges         String[] // Array of badges: FEATURED, BESTSELLER, NEW, TRENDING, POPULAR
  benefits       String[]           @default([]) // Benefits of the course
  curriculumText String?            @db.Text // For online: curriculum as text (HTML)
  deliveryMode   CourseDeliveryMode @default(BOTH) // ONLINE, SELF_PACED, or BOTH
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt

  sessions    CourseSession[]
  enrollments CourseEnrollment[]
  orders      CourseOrder[]
  categories  CourseCategoryRelation[]
  reviews     CourseReview[]
  completions CourseCompletion[]
  bundles     BundleCourse[]

  @@index([slug])
  @@index([isPublished])
  @@index([isFree])
}

model CourseSession {
  id          String   @id @default(cuid())
  courseId    String
  title       String
  description String?  @db.Text
  order       Int      @default(1)
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  course    Course            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  chapters  CourseChapter[]
  resources SessionResource[]

  @@index([courseId])
  @@index([order])
}

model CourseChapter {
  id            String   @id @default(cuid())
  sessionId     String
  title         String
  slug          String
  videoUrl      String? // YouTube URL (DEPRECATED - kept for backward compatibility)
  bunnyVideoId  String? // Bunny.net video ID
  videoDuration Int? // Duration in seconds
  videoStatus   Int      @default(0) // Bunny status: 0-Created, 1-Uploaded, 2-Processing, 3-Transcoding, 4-Ready, 5-Error, 6-Upload Failed
  duration      Int? // Duration in seconds (auto-calculated from YouTube)
  isFreePreview Boolean  @default(false)
  isPublished   Boolean  @default(false)
  order         Int      @default(1)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  session  CourseSession     @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  progress ChapterProgress[]

  @@unique([sessionId, slug])
  @@index([sessionId])
  @@index([order])
  @@index([slug])
  @@index([bunnyVideoId])
}

model SessionResource {
  id        String   @id @default(cuid())
  sessionId String
  fileName  String
  fileUrl   String // R2 URL
  fileSize  Int? // Size in bytes
  createdAt DateTime @default(now())

  session CourseSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([sessionId])
}

model CourseEnrollment {
  id         String   @id @default(cuid())
  courseId   String
  userId     String
  enrolledAt DateTime @default(now())

  course   Course            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user     User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  progress ChapterProgress[]

  @@unique([courseId, userId])
  @@index([courseId])
  @@index([userId])
}

model ChapterProgress {
  id            String    @id @default(cuid())
  chapterId     String
  enrollmentId  String
  progress      Float     @default(0) // Percentage 0-100
  completed     Boolean   @default(false)
  lastWatchedAt DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  chapter    CourseChapter    @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  enrollment CourseEnrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)

  @@unique([chapterId, enrollmentId])
  @@index([chapterId])
  @@index([enrollmentId])
}

model CourseOrder {
  id       String @id @default(cuid())
  courseId String
  userId   String
  orderId  String

  amountPaid    Float
  paymentId     String?
  paymentStatus String // CREATED | PAID | FAILED
  paymentMode   String? // RAZORPAY

  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  order  Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([courseId])
  @@index([userId])
  @@index([orderId])
}

model CourseReview {
  id        String   @id @default(cuid())
  userId    String
  courseId  String
  rating    Int // 1-5
  comment   String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId]) // One review per user per course
  @@index([courseId])
  @@index([userId])
}

// ===============================
// CERTIFICATE SYSTEM
// ===============================

enum CertificateType {
  COURSE
  WEBINAR
  MENTORSHIP
  GUIDANCE
  OFFLINE_BATCH
  BUNDLE
}

enum CertificateStatus {
  GENERATED
  REVOKED
}

model Certificate {
  id             String            @id @default(cuid())
  userId         String
  type           CertificateType
  referenceId    String // courseId OR webinarId
  certificateNo  String            @unique
  certificateUrl String? // PDF stored in R2
  issuedAt       DateTime          @default(now())
  status         CertificateStatus @default(GENERATED)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, type, referenceId])
  @@index([userId])
  @@index([type])
  @@index([certificateNo])
}

// Certificate Templates - Admin creates designs for each product type
model CertificateTemplate {
  id          String          @id @default(cuid())
  type        CertificateType @unique // One template per type
  name        String // e.g., "Course Completion Certificate"
  description String?         @db.Text

  // Design Elements
  signatureUrl  String? // Admin signature image (R2)
  stampUrl      String? // Admin stamp image (R2)
  logoUrl       String? // Custom logo (R2)
  backgroundUrl String? // Background image (R2)

  // Text Settings
  issuerName  String  @default("Shrestha Academy")
  issuerTitle String  @default("Platform Director")
  footerText  String? @db.Text

  // Styling
  primaryColor   String @default("#6366F1")
  secondaryColor String @default("#A5B4FC")

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([isActive])
}

model CourseCompletion {
  id          String   @id @default(cuid())
  courseId    String
  userId      String
  completedAt DateTime @default(now())

  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([courseId, userId])
  @@index([courseId])
  @@index([userId])
}

model WebinarCompletion {
  id          String   @id @default(cuid())
  webinarId   String
  userId      String
  completedAt DateTime @default(now())

  webinar Webinar @relation(fields: [webinarId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([webinarId, userId])
  @@index([webinarId])
  @@index([userId])
}

// Flash Sale for promotions
enum FlashSaleType {
  COURSE
  EBOOK
  WEBINAR
  GUIDANCE
  BUNDLE
  OFFLINE_BATCH
}

model FlashSale {
  id              String        @id @default(cuid())
  type            FlashSaleType
  referenceIds    String[] // Array of IDs of courses/ebooks/webinars/guidance/indicators
  title           String // Sale title e.g. "Black Friday Sale!"
  subtitle        String? // Subtitle e.g. "Save up to 60%"
  discountPercent Int // Discount percentage
  theme           String        @default("default") // default, blackfriday, diwali, holi, christmas, newyear
  bgColor         String        @default("#dc2626") // Background color
  textColor       String        @default("#ffffff") // Text color
  startDate       DateTime
  endDate         DateTime
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([isActive])
  @@index([type])
  @@index([startDate])
  @@index([endDate])
}

model CartItem {
  id        String   @id @default(cuid())
  userId    String
  itemType  String // EBOOK, WEBINAR, GUIDANCE, COURSE, BUNDLE
  itemId    String // ID of the item
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, itemType, itemId]) // One item per type per user
  @@index([userId])
  @@index([itemType])
}

model FooterLink {
  id        String   @id @default(cuid())
  label     String
  url       String
  icon      String? // Icon name (e.g., "Facebook", "Twitter", "Instagram")
  color     String? // Hex color code
  order     Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive])
  @@index([order])
}

enum OfflineBatchPricingType {
  FREE
  PAID
}

enum OfflineBatchStatus {
  DRAFT
  OPEN
  FULL
  CLOSED
}

model OfflineBatch {
  id    String @id @default(cuid())
  title String
  slug  String @unique

  // üñºÔ∏è THUMBNAIL IMAGE
  thumbnail String? // Cloudflare R2 image URL

  // üìù DESCRIPTION
  shortDescription String?
  description      String  @db.Text

  // üìç LOCATION DETAILS
  centerName String
  address    String
  city       String
  state      String
  googleMap  String? // Google Maps link

  // üóìÔ∏è DATE & TIME
  startDate DateTime
  endDate   DateTime
  startTime String // HH:mm
  endTime   String // HH:mm
  days      String[] // MON, TUE, WED

  // üë®‚Äçüè´ INSTRUCTOR
  instructorName String
  instructorBio  String?

  // üí∞ PRICING LOGIC
  pricingType OfflineBatchPricingType @default(PAID)
  price       Float? // shown only if PAID
  salePrice   Float? // optional
  isFree      Boolean                 @default(false)

  // ü™ë SEAT LOGIC
  isUnlimitedSeats Boolean @default(false)
  seatLimit        Int?
  seatsFilled      Int     @default(0)

  // üì¶ WHAT STUDENT GETS
  includesNotes        Boolean @default(true)
  includesRecordings   Boolean @default(false)
  includesTests        Boolean @default(true)
  includesDoubtSupport Boolean @default(true)

  // üì¢ STATUS
  status OfflineBatchStatus @default(DRAFT)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  enrollments OfflineBatchEnrollment[]
  orders      OfflineBatchOrder[]

  @@index([slug])
  @@index([status])
  @@index([city])
}

model OfflineBatchEnrollment {
  id      String @id @default(cuid())
  batchId String
  userId  String

  paymentStatus String // PAID | PARTIAL | UNPAID
  amountPaid    Float
  paymentMode   String? // CASH | UPI | RAZORPAY

  enrolledAt DateTime @default(now())

  batch OfflineBatch @relation(fields: [batchId], references: [id], onDelete: Cascade)
  user  User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([batchId, userId])
  @@index([batchId])
  @@index([userId])
}

model OfflineBatchOrder {
  id      String @id @default(cuid())
  batchId String
  userId  String
  orderId String

  amountPaid    Float
  paymentId     String?
  paymentStatus String // CREATED | PAID | FAILED
  paymentMode   String? // RAZORPAY

  batch OfflineBatch @relation(fields: [batchId], references: [id], onDelete: Cascade)
  user  User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  order Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([batchId])
  @@index([userId])
  @@index([orderId])
}

// =====================================
// BUNDLE SYSTEM
// =====================================

model Bundle {
  id               String   @id @default(cuid())
  title            String
  slug             String   @unique
  shortDescription String?  @db.Text
  description      String   @db.Text
  thumbnail        String? // Cloudflare R2 image URL
  price            Float    @default(0)
  salePrice        Float?
  isPublished      Boolean  @default(false)
  badges           String[] // FEATURED, BESTSELLER, NEW, TRENDING, POPULAR
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  courses     BundleCourse[]
  enrollments BundleEnrollment[]
  orders      BundleOrder[]

  @@index([slug])
  @@index([isPublished])
}

// Bundle-Course many-to-many relationship
model BundleCourse {
  id       String @id @default(cuid())
  bundleId String
  courseId String

  bundle Bundle @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  course Course @relation(fields: [courseId], references: [id], onDelete: Restrict)

  @@unique([bundleId, courseId])
  @@index([bundleId])
  @@index([courseId])
}

model BundleEnrollment {
  id         String   @id @default(cuid())
  bundleId   String
  userId     String
  enrolledAt DateTime @default(now())

  bundle Bundle @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([bundleId, userId])
  @@index([bundleId])
  @@index([userId])
}

model BundleOrder {
  id       String @id @default(cuid())
  bundleId String
  userId   String
  orderId  String

  amountPaid    Float
  paymentId     String?
  paymentStatus String // CREATED | PAID | FAILED
  paymentMode   String? // RAZORPAY

  bundle Bundle @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  order  Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([bundleId])
  @@index([userId])
  @@index([orderId])
}

// =====================================
// CONTACT SYSTEM
// =====================================

model Contact {
  id      String  @id @default(cuid())
  name    String
  email   String
  phone   String?
  subject String
  message String  @db.Text
  isRead  Boolean @default(false)

  replySent Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([isRead])
  @@index([createdAt])
}

// =====================================
// INVOICE SETTINGS (single row for admin)
// =====================================
model InvoiceSettings {
  id               String   @id @default(cuid())
  companyName      String?
  logo             String? // R2 path or URL (MediaPicker)
  stamp            String? // Optional stamp image (e.g. for signature)
  address          String?  @db.Text
  city             String?
  state            String?
  pincode          String?
  gstNumber        String?
  gstRateCourse    Float? // GST % on courses (e.g. 18)
  gstRateNonCourse Float? // GST % on ebook/other (e.g. 0 or 18)
  phone            String?
  email            String?
  website          String?
  bankName         String?
  bankAccount      String?
  ifscCode         String?
  invoicePrefix    String? // e.g. "INV/" so invoice # = INV/ORD-123
  taxPresets       String?  @db.Text // JSON: [{ "label": "Course (GST 18%)", "rate": 18 }, { "label": "Ebook (0%)", "rate": 0 }, { "label": "Office/Service (12%)", "rate": 12 }]
  terms            String?  @db.Text
  footerText       String?  @db.Text
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

// Manual invoice - kisi bhi cheez ke liye (course, ebook, office, service): custom bill-to, items, tax
model ManualInvoice {
  id            String    @id @default(cuid())
  invoiceNumber String    @unique // INV/MAN-001
  billToName    String
  billToEmail   String?
  billToPhone   String?
  billToAddress String?   @db.Text
  invoiceDate   DateTime
  dueDate       DateTime?
  items         String    @db.Text // JSON: [{ description, qty, unitPrice, taxLabel, taxRate, amount }]
  subtotal      Decimal   @db.Decimal(12, 2)
  taxTotal      Decimal   @db.Decimal(12, 2)
  discount      Decimal   @default(0) @db.Decimal(12, 2)
  total         Decimal   @db.Decimal(12, 2)
  currency      String    @default("INR")
  notes         String?   @db.Text
  status        String    @default("DRAFT") // DRAFT, SENT, PAID
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([invoiceNumber])
  @@index([invoiceDate])
  @@index([status])
}

// =====================================
// HOMEPAGE BANNERS (admin-managed)
// =====================================
model Banner {
  id             String   @id @default(cuid())
  title          String?
  imageUrl       String? // Desktop: 1200√ó450 px (MediaPicker)
  imageUrlMobile String? // Mobile: 800√ó400 px (MediaPicker)
  link           String? // Optional link on click
  sortOrder      Int      @default(0)
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([isActive])
  @@index([sortOrder])
}

// =====================================
// PLACEMENT (name, company, designation)
// =====================================
model Placement {
  id          String   @id @default(cuid())
  name        String
  company     String
  designation String
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([sortOrder])
}

// =====================================
// TRAINING SCHEDULE (demo calendar - register for online demo)
// =====================================
model TrainingSchedule {
  id              String    @id @default(cuid())
  title           String
  topic           String? // e.g. Python, Data Analytics
  scheduledAt     DateTime? // optional ‚Äì leave empty for "contact for schedule" / flexible, stays visible
  durationMinutes Int?      @default(60)
  description     String?   @db.Text
  registrationUrl String? // form / other link
  meetLink        String? // Zoom or Google Meet URL ‚Äì join demo
  whatsappLink    String? // WhatsApp group link ‚Äì for more updates
  trainingType    String? // e_Learning | Classroom | Online
  isActive        Boolean   @default(true)
  sortOrder       Int       @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([scheduledAt])
  @@index([isActive])
  @@index([trainingType])
}

// Book a Demo ‚Äì user/guest details (admin can verify and list)
model DemoRequest {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  courseId  String? // optional ‚Äì which course demo they want
  message   String?  @db.Text
  userId    String? // optional ‚Äì if logged in
  status    String   @default("PENDING") // PENDING, CONTACTED, CONVERTED, CANCELLED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}

// Mock Interview ‚Äì admin creates slots (date, time, Zoom, price); users book
model MockInterviewSlot {
  id          String                 @id @default(cuid())
  slotDate    DateTime // date of slot (time part ignored)
  startTime   String // e.g. "10:00 AM"
  endTime     String? // e.g. "11:00 AM"
  meetingLink String? // Zoom / Google Meet
  price       Int                    @default(0) // in paise (‚Çπ100 = 10000)
  currency    String                 @default("INR")
  isActive    Boolean                @default(true)
  maxBookings Int? // null = unlimited
  sortOrder   Int                    @default(0)
  createdAt   DateTime               @default(now())
  updatedAt   DateTime               @updatedAt
  bookings    MockInterviewBooking[]

  @@index([slotDate])
  @@index([isActive])
}

model MockInterviewBooking {
  id        String            @id @default(cuid())
  slotId    String
  slot      MockInterviewSlot @relation(fields: [slotId], references: [id], onDelete: Cascade)
  name      String
  email     String
  phone     String
  message   String?           @db.Text
  userId    String?
  status    String            @default("PENDING") // PENDING, CONFIRMED, CANCELLED, COMPLETED
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  @@index([slotId])
  @@index([email])
  @@index([status])
}

// Practice with expert feedback ‚Äì admin creates, users see listing
model ExpertPractice {
  id          String                  @id @default(cuid())
  title       String
  slug        String                  @unique
  description String?                 @db.Text
  price       Float                   @default(0)
  isFree      Boolean                 @default(false)
  isActive    Boolean                 @default(true)
  sortOrder   Int                     @default(0)
  createdAt   DateTime                @default(now())
  updatedAt   DateTime                @updatedAt
  bookings    ExpertPracticeBooking[]

  @@index([isActive])
  @@index([slug])
}

// User bookings for practice-with-expert (form on public page)
model ExpertPracticeBooking {
  id               String         @id @default(cuid())
  expertPracticeId String
  name             String
  email            String
  phone            String?
  message          String?        @db.Text
  status           String         @default("PENDING") // PENDING, CONTACTED, CONVERTED, CANCELLED
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  expertPractice   ExpertPractice @relation(fields: [expertPracticeId], references: [id], onDelete: Cascade)

  @@index([expertPracticeId])
  @@index([status])
  @@index([createdAt])
}

// Hire From Us ‚Äì company hiring request form (public page)
model HireFromUsRequest {
  id                 String   @id @default(cuid())
  companyName        String
  contactName        String
  email              String
  phone              String?
  hiringRequirements String?  @db.Text
  source             String   @default("hire-from-us")
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([email])
  @@index([createdAt])
  @@index([source])
}

// Placement Training ‚Äì registration + email OTP verification
model PlacementTrainingRegistration {
  id             String    @id @default(cuid())
  name           String
  email          String
  countryCode    String    @default("+91")
  whatsappNumber String
  course         String
  notes          String?   @db.Text
  isVerified     Boolean   @default(false)
  otpCode        String?
  otpExpiresAt   DateTime?
  source         String    @default("placement-training")
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([email])
  @@index([isVerified])
  @@index([course])
  @@index([createdAt])
  @@index([source])
}

// ===============================
// JOB / CAREER SYSTEM
// ===============================

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  FREELANCE
  REMOTE
  HYBRID
  ON_SITE
}

enum JobStatus {
  DRAFT
  PENDING // User posted, waiting for admin
  PUBLISHED // Live
  CLOSED // Post removed/filled
  REJECTED // Admin rejected
}

model Job {
  id          String  @id @default(cuid())
  title       String
  slug        String  @unique
  companyName String? // If posted by external or simple text
  companyLogo String? // R2 URL

  // Job Details
  description  String  @db.Text // Rich text
  requirements String? @db.Text
  location     String?
  salary       String? // e.g. "10LPA - 15LPA" or "Confidential"

  // Meta
  type       JobType[] // Array of types, e.g. [FULL_TIME, REMOTE]
  experience String? // e.g. "2-5 Years"
  skills     String[] // Array of strings

  // Application
  applyLink        String? // External link
  allowsQuickApply Boolean @default(true) // If true, use internal apply form

  // Author & Status
  authorId String? // Null if posted by admin directly without user context, or link to User
  user     User?   @relation(fields: [authorId], references: [id], onDelete: SetNull)

  status     JobStatus @default(PENDING)
  isVerified Boolean   @default(false) // Simplified check for "Live" = status:PUBLISHED + isVerified:true

  // Timestamps
  postedAt  DateTime?
  expiresAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  jobApplications JobApplication[]

  @@index([slug])
  @@index([status])
  @@index([isVerified])
}

model JobApplication {
  id     String  @id @default(cuid())
  jobId  String
  userId String? // Optional if we allow allow non-logged in (but user requested allow logged in)

  // Applicant Info
  name        String
  email       String
  phone       String?
  resumeUrl   String? // R2 URL
  coverLetter String? @db.Text

  status String @default("APPLIED") // APPLIED, REVIEWED, SHORTLISTED, REJECTED, HIRED

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  job  Job   @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([jobId])
  @@index([userId])
}

// ==================== INTERVIEW QUESTIONS ====================

model InterviewCategory {
  id          String  @id @default(uuid())
  name        String  @unique // Category name (Python, Java, etc.)
  slug        String  @unique // URL-friendly slug
  description String? // Optional description
  icon        String? // Optional icon name
  sortOrder   Int     @default(0)
  isActive    Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  questions InterviewQuestion[]

  @@index([slug])
  @@index([isActive])
}

model InterviewQuestion {
  id String @id @default(uuid())

  // Core fields
  title  String // Question text
  slug   String @unique // URL-friendly slug
  answer String @db.Text // Rich HTML answer content

  // Categorization
  categoryId String
  category   InterviewCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  // Optional fields
  difficulty String? // Easy, Medium, Hard
  tags       String[] @default([]) // Additional tags for filtering

  // Meta  
  isPublished Boolean @default(true)
  sortOrder   Int     @default(0) // For custom ordering

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([categoryId])
  @@index([isPublished])
  @@index([slug])
}

// ==================== CORPORATE TRAINING ====================

model CorporateTraining {
  id          String  @id @default(uuid())
  title       String
  slug        String  @unique
  description String  @db.Text
  image       String?

  // Program Details
  curriculum Json    @default("[]") // Array of modules/topics
  features   Json    @default("[]") // Key highlights
  duration   String?
  mode       String? // "Online", "On-site", "Hybrid"
  price      Float? // Optional price

  // Meta
  isActive  Boolean @default(true)
  sortOrder Int     @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  inquiries CorporateTrainingInquiry[]

  @@index([slug])
  @@index([isActive])
}

model CorporateTrainingInquiry {
  id          String  @id @default(uuid())
  name        String
  email       String
  phone       String
  companyName String?
  message     String? @db.Text

  // Training Interest (Optional)
  trainingId String?
  training   CorporateTraining? @relation(fields: [trainingId], references: [id], onDelete: SetNull)

  status    InquiryStatus @default(NEW)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@index([email])
  @@index([status])
}

enum InquiryStatus {
  NEW
  CONTACTED
  CONVERTED
  CLOSED
}
